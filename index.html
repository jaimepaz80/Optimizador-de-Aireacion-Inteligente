<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador de Aireaci√≥n v3.0 (H√≠brido)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f4f8; color: #333; display: flex; justify-content: center; align-items: flex-start; padding: 20px; gap: 20px; }
        .container { display: flex; flex-wrap: wrap; gap: 30px; width: 100%; max-width: 1200px; }
        .panel { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .config-panel { flex-basis: 350px; flex-shrink: 0; flex-grow: 1; }
        .results-panel { flex-basis: 500px; flex-grow: 2; }
        h1, h2 { color: #005f73; border-bottom: 2px solid #005f73; padding-bottom: 10px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; }
        input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1em; }
        button { width: 100%; padding: 12px; background-color: #0a9396; color: white; border: none; border-radius: 4px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #005f73; }
        #pool-container { position: relative; background-color: #e0f7fa; border: 2px solid #0077b6; margin-top: 20px; overflow: hidden; transition: all 0.5s; }
        .aerator { position: absolute; width: 20px; height: 20px; background-color: #ee9b00; border: 1px solid #9b2226; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 12px; font-weight: bold; cursor: pointer; transform: translate(-50%, -50%); }
        .aerator .arrow { color: #9b2226; }
        #summary ul { list-style: none; padding: 0; }
        #summary li { background-color: #f8f9fa; border-left: 4px solid #0a9396; padding: 10px; margin-bottom: 8px; }
        .strategy-title { color: #d90429; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel config-panel">
            <h1>Optimizador de Aireaci√≥n ü¶ê v3.0</h1>
            <div id="config-form">
                <div class="form-group"><label for="length">Largo (mts):</label><input type="number" id="length" value="400"></div>
                <div class="form-group"><label for="width">Ancho (mts):</label><input type="number" id="width" value="100"></div>
                <div class="form-group"><label for="biomass">Biomasa M√°xima (kg):</label><input type="number" id="biomass" value="12000"></div>
                <div class="form-group"><label for="hp">Potencia por Aireador (HP):</label><input type="number" id="hp" value="4"></div>
                <button onclick="calculate()">Calcular Distribuci√≥n √ìptima</button>
            </div>
        </div>
        <div class="panel results-panel">
            <h2>Resultados de Simulaci√≥n</h2>
            <div id="pool-container"></div>
            <div id="summary"></div>
        </div>
    </div>

    <script>
        function calculate() {
            const length = parseFloat(document.getElementById('length').value);
            const width = parseFloat(document.getElementById('width').value);
            const biomass = parseFloat(document.getElementById('biomass').value);
            const hpPerAerator = parseFloat(document.getElementById('hp').value);

            if (isNaN(length) || isNaN(width) || isNaN(biomass) || isNaN(hpPerAerator) || length <= 0 || width <= 0) {
                alert("Por favor, introduce valores v√°lidos y positivos."); return;
            }

            const KG_PER_HP = 180;
            const totalHpNeeded = biomass / KG_PER_HP;
            const numAerators = Math.ceil(totalHpNeeded / hpPerAerator);
            
            const area = length * width;
            const poolContainer = document.getElementById('pool-container');
            const summaryDiv = document.getElementById('summary');
            poolContainer.innerHTML = '';

            const long_side = Math.max(length, width);
            const short_side = Math.min(length, width);
            const aspect_ratio = long_side / short_side;

            let strategy_name = "";

            // --- L√ìGICA V3.0: SELECCI√ìN DE ESTRATEGIA ---
            if (aspect_ratio > 1.3) {
                if (long_side > 150 && numAerators >= 4) {
                    strategy_name = "Rectangular Grande: Racetrack Asistido";
                    strategy_Rectangular_Large(length, width, numAerators);
                } else {
                    strategy_name = "Rectangular: Racetrack Cl√°sico";
                    strategy_Rectangular_Classic(length, width, numAerators);
                }
            } else {
                strategy_name = "Cuadrada: V√≥rtice Circular";
                strategy_Square_Vortex(length, width, numAerators);
            }
            
            drawPool(length, width);
            
            summaryDiv.innerHTML = `
                <h2>Resumen T√©cnico (v3.0)</h2>
                <ul>
                    <li><span class="strategy-title">Estrategia Aplicada:</span> ${strategy_name}</li>
                    <li><strong>√Årea de la Piscina:</strong> ${area.toFixed(2)} m¬≤</li>
                    <li><strong>HP Totales Recomendados:</strong> ${totalHpNeeded.toFixed(2)} HP</li>
                    <li><strong>N¬∞ de Aireadores de ${hpPerAerator} HP:</strong> ${numAerators} unidades</li>
                </ul>
            `;
        }
        
        function strategy_Rectangular_Large(l, w, total) {
            const aerators_on_long_sides = total - 2;
            const side1_count = Math.ceil(aerators_on_long_sides / 2);
            const side2_count = Math.floor(aerators_on_long_sides / 2);

            // Aireadores en lados largos
            placeAeratorsOnSide(side1_count, 'long', 'a', l, w);
            placeAeratorsOnSide(side2_count, 'long', 'b', l, w);
            // Aireadores en lados cortos para asistir
            placeAeratorsOnSide(1, 'short', 'a', l, w);
            placeAeratorsOnSide(1, 'short', 'b', l, w);
        }

        function strategy_Rectangular_Classic(l, w, total) {
            const side1_count = Math.ceil(total / 2);
            const side2_count = Math.floor(total / 2);
            placeAeratorsOnSide(side1_count, 'long', 'a', l, w);
            placeAeratorsOnSide(side2_count, 'long', 'b', l, w);
        }

        function strategy_Square_Vortex(l, w, total) {
            const per_side = Math.floor(total / 4);
            let remainder = total % 4;
            
            const sides = [per_side, per_side, per_side, per_side];
            for (let i = 0; i < remainder; i++) sides[i]++;

            placeAeratorsOnSide(sides[0], 'top', 'vortex', l, w);
            placeAeratorsOnSide(sides[1], 'right', 'vortex', l, w);
            placeAeratorsOnSide(sides[2], 'bottom', 'vortex', l, w);
            placeAeratorsOnSide(sides[3], 'left', 'vortex', l, w);
        }

        function placeAeratorsOnSide(count, side, type, l, w) {
            if (count === 0) return;
            const margin_percent = 0.15;

            for (let i = 0; i < count; i++) {
                let top=0, left=0, arrow = '';
                const pos = (i + 1) / (count + 1) * 100;
                
                if (side === 'long') { // Racetrack
                    left = (type === 'a') ? (100 - margin_percent * 100) : (margin_percent * 100);
                    top = pos;
                    arrow = (type === 'a') ? '‚Üë' : '‚Üì';
                } else if (side === 'short') { // Asistencia
                    top = (type === 'a') ? (margin_percent * 100) : (100 - margin_percent * 100);
                    left = pos;
                    arrow = (type === 'a') ? '‚Üí' : '‚Üê';
                } else { // Vortex
                    const vortex_margin = 0.20 * 100;
                    if (side === 'top') { top = vortex_margin; left = pos; arrow = '‚Üí'; }
                    if (side === 'right') { left = 100 - vortex_margin; top = pos; arrow = '‚Üì'; }
                    if (side === 'bottom') { top = 100 - vortex_margin; left = pos; arrow = '‚Üê'; }
                    if (side === 'left') { left = vortex_margin; top = pos; arrow = '‚Üë'; }
                }
                createAerator(top, left, arrow);
            }
        }

        function createAerator(topPercent, leftPercent, arrow) {
            const pool = document.getElementById('pool-container');
            const aerator = document.createElement('div');
            aerator.className = 'aerator';
            aerator.style.top = `${topPercent}%`;
            aerator.style.left = `${leftPercent}%`;
            aerator.innerHTML = `<span class="arrow">${arrow}</span>`;
            pool.appendChild(aerator);
        }

        function drawPool(length, width) {
            const poolContainer = document.getElementById('pool-container');
            const aspectRatio = width / length;
            const containerWidth = poolContainer.parentElement.clientWidth - 40;
            let displayWidth = containerWidth;
            let displayHeight = displayWidth * aspectRatio;
            if (displayHeight > 500) {
                displayHeight = 500;
                displayWidth = displayHeight / aspectRatio;
            }
            poolContainer.style.width = `${displayWidth}px`;
            poolContainer.style.height = `${displayHeight}px`;
        }

        window.onload = calculate;
    </script>
</body>
</html>
